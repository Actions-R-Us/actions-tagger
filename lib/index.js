module.exports=function(e,t){"use strict";var r={};function __webpack_require__(t){if(r[t]){return r[t].exports}var n=r[t]={i:t,l:false,exports:{}};var a=true;try{e[t].call(n.exports,n,n.exports,__webpack_require__);a=false}finally{if(a)delete r[t]}n.l=true;return n.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(733)}return startup()}({62:function(module){module.exports=eval("require")("semver/functions/valid")},209:function(module){module.exports=eval("require")("@actions/core")},219:function(module){module.exports=eval("require")("semver/functions/coerce")},494:function(module){module.exports=eval("require")("@actions/github")},530:function(module){module.exports=eval("require")("semver/functions/parse")},733:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.hasOwnProperty.call(e,r))n(t,e,r);a(t,e);return t};var s=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,a){function fulfilled(e){try{step(n.next(e))}catch(e){a(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){a(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};var u=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,a&&(i=s[0]&2?a["return"]:s[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;if(a=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;a=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1];i=s;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(s);break}if(i[2])r.ops.pop();r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e];a=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});var l=i(r(209));var f=o(r(494));var c=o(r(756));var d=r(745);var p=r(891);function ifErrorSubmitBug(){l.info("If you believe this to be an error, please submit a bug report");l.info("https://github.com/Actions-R-Us/actions-tagger/issues");if(l.isDebug()){l.debug("event: "+process.env.GITHUB_EVENT_NAME);l.debug("tag_name: "+d.releaseTag().version)}}function outputRefName(e){l.setOutput("ref_name",e)}function outputLatest(e){l.setOutput("latest",e.toString())}function run(){return s(this,void 0,void 0,function(){var e,t,r,n,a,i,s,o,v,h;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,7,,8]);if(!d.isPublishedRelease()&&!d.isEditedRelease()){l.info("This action should only be used in a release context");ifErrorSubmitBug();return[2]}if(!d.isSemVersionedRelease()){l.info("This action can only operate on semantically versioned releases");ifErrorSubmitBug();return[2]}if(!process.env.GITHUB_TOKEN)return[3,5];e=f.default.getOctokit(process.env.GITHUB_TOKEN);return[4,d.findLatestReleases(e)];case 1:t=u.sent(),r=t.repoLatest,n=t.majorLatest;a=d.releaseTag();if(!c.default(a,n))return[3,3];i=p.preferences.publishLatestTag&&c.default(a,r);return[4,d.createRequiredRefs(e,i)];case 2:s=u.sent(),o=s.ref,v=s.latest;outputRefName(o);outputLatest(v);return[3,4];case 3:l.info("Nothing to do because release commit is earlier than major tag commit");ifErrorSubmitBug();u.label=4;case 4:return[3,6];case 5:l.setFailed("Expected a `GITHUB_TOKEN` environment variable");u.label=6;case 6:return[3,8];case 7:h=u.sent();l.setFailed(h.message);return[3,8];case 8:return[2]}})})}run()},745:function(e,t,r){"use strict";var n=this&&this.__assign||function(){n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a))e[a]=t[a]}return e};return n.apply(this,arguments)};var a=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.hasOwnProperty.call(e,r))a(t,e,r);i(t,e);return t};var u=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,a){function fulfilled(e){try{step(n.next(e))}catch(e){a(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){a(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};var o=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,a&&(i=s[0]&2?a["return"]:s[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;if(a=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;a=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1];i=s;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(s);break}if(i[2])r.ops.pop();r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e];a=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.createRequiredRefs=t.findLatestReleases=t.getPreferredRef=t.majorVersion=t.isSemVersionedRelease=t.isEditedRelease=t.isPublishedRelease=t.releaseTag=void 0;var f=s(r(209));var c=r(494);var d=l(r(219));var p=l(r(62));var v=l(r(943));var h=l(r(530));var b=l(r(762));var g=r(891);function isRelease(){return c.context.eventName==="release"}function isPublicRelease(){return isRelease()&&!isPreRelease()}function isPreRelease(){var e;return((e=c.context.payload.release)===null||e===void 0?void 0:e.prerelease)===true}function releaseTag(){var e;var t=(e=c.context.payload.release)===null||e===void 0?void 0:e.tag_name;if(isPreRelease()){t=d.default(t,{includePrerelease:true})}return h.default(t)}t.releaseTag=releaseTag;function isPublishedRelease(){return isPublicRelease()&&c.context.payload.action==="published"}t.isPublishedRelease=isPublishedRelease;function isEditedRelease(){return isPublicRelease()&&c.context.payload.action==="edited"}t.isEditedRelease=isEditedRelease;function isSemVersionedRelease(){return p.default(releaseTag())!==null}t.isSemVersionedRelease=isSemVersionedRelease;function majorVersion(){return v.default(releaseTag())}t.majorVersion=majorVersion;function getPreferredRef(){if(g.preferences.preferBranchRelease){return"heads"}return"tags"}t.getPreferredRef=getPreferredRef;function findLatestReleases(e){return u(this,void 0,void 0,function(){var t,r,n,a,i,s,u,l,d,p;return o(this,function(o){switch(o.label){case 0:t=releaseTag();r=t;n=r;a=majorVersion();if(f.isDebug()){f.debug("Found the following releases:")}i=void 0;o.label=1;case 1:if(false){}return[4,e.graphql(g.queryAllRefs,{repoName:c.context.repo.repo,repoOwner:c.context.repo.owner,majorRef:"refs/"+getPreferredRef()+"/",pagination:i})];case 2:s=o.sent().repository;for(u=0,l=s.refs.refsList;u<l.length;u++){d=l[u].ref;p=h.default(d.name);if(p!==null){if(p.major===a&&b.default(p,n)){n=p}if(b.default(p,r)){r=p}}}if(s.refs.pageInfo.hasNextPage){i=s.refs.pageInfo.endCursor}else{return[3,4]}o.label=3;case 3:return[3,1];case 4:return[2,{repoLatest:r.version,majorLatest:n.version}]}})})}t.findLatestReleases=findLatestReleases;function createRequiredRefs(e,t){return u(this,void 0,void 0,function(){var r,n,a;return o(this,function(i){switch(i.label){case 0:r=majorVersion();n=getPreferredRef()+"/v"+r;return[4,createRef(e,n)];case 1:i.sent();a=t!==null&&t!==void 0?t:g.preferences.publishLatestTag;if(!a)return[3,3];return[4,createRef(e,"tags/latest")];case 2:i.sent();i.label=3;case 3:return[2,{ref:n,latest:a}]}})})}t.createRequiredRefs=createRequiredRefs;function createRef(e,t){return u(this,void 0,void 0,function(){var r,a,i;return o(this,function(s){switch(s.label){case 0:return[4,e.git.listMatchingRefs(n(n({},c.context.repo),{ref:t}))];case 1:r=s.sent().data;a=r.find(function(e){return e.ref.endsWith(t)});if(!(a!==undefined))return[3,3];f.debug("Updating ref: "+t+" to: "+process.env.GITHUB_SHA);return[4,e.git.updateRef(n(n({},c.context.repo),{force:true,ref:t,sha:process.env.GITHUB_SHA}))];case 2:i=s.sent().data;return[3,5];case 3:f.debug("Creating ref: refs/"+t+" for: "+process.env.GITHUB_SHA);return[4,e.git.createRef(n(n({},c.context.repo),{ref:"refs/"+t,sha:process.env.GITHUB_SHA}))];case 4:i=s.sent().data;s.label=5;case 5:if(f.isDebug()){f.debug(JSON.stringify(i))}return[2]}})})}},756:function(module){module.exports=eval("require")("semver/functions/gte")},762:function(module){module.exports=eval("require")("semver/functions/gt")},891:function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:true});t.queryAllRefs=t.preferences=void 0;t.preferences={publishLatestTag:((r=process.env.INPUT_PUBLISH_LATEST)!==null&&r!==void 0?r:process.env.INPUT_PUBLISH_LATEST_TAG).toLowerCase()==="true",preferBranchRelease:process.env.INPUT_PREFER_BRANCH_RELEASES.toLowerCase()==="true"};t.queryAllRefs='\nquery ($repoOwner: String!, $repoName: String!, $majorRef: String!, $pagination: String = "") {\n  repository(name: $repoName, owner: $repoOwner) {\n    refs(refPrefix: $majorRef, first: 100, after: $pagination, orderBy: {field: ALPHABETICAL, direction: DESC}) {\n      refsList: edges {\n        ref: node {\n          name\n        }\n      }\n      pageInfo {\n        endCursor\n        hasNextPage\n      }\n      totalCount\n    }\n  }\n}'},943:function(module){module.exports=eval("require")("semver/functions/major")}});